/**
 * @file lions.c
 *
 * @brief Checksum Calculation and Validation
 *
 * This file contains the implementation of the message LMsg functions generated
 * by the Lions Compiler.
 *
 * @details
 * This file was generated by the Lions Compiler
 * (https://github.com/ItsNotSoftware/lions) on . Modifying this file manually
 * is not recommended as it may lead to unexpected behavior.
 *
 * @note
 * Generated files should not be manually edited.
 *
 * @author Lions Compiler
 */

#include "lions.h"

uint16_t LMsg_calculate_checksum(LMsg *msg) {
    uint16_t *checksum = &msg->header.checksum;
    *checksum = 0;

    // Calculate the checksum for the header
    *checksum += msg->header.src;
    *checksum += msg->header.dst;
    *checksum += msg->header.msg_id;
    *checksum += msg->header.next_hop;

    // Calculate the checksum for the payload
    for (int i = 0; i < msg->payload_size; i++) {
        *checksum += msg->payload[i];
    }

    *checksum = ~(*checksum);

    return *checksum;
}

bool LMsg_valid_checksum(LMsg *msg) {
    uint16_t prev_checksum = msg->header.checksum;
    return LMsg_calculate_checksum(msg) == prev_checksum;
}
